<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STERLA - PREMIUM AI LEARNING APP</title>
<style>
:root{
--black:#0b0b0d; --card:#111216; --light-blue:#84d2ff; --light-purple:#c2b3ff;
--gold:#ffd700; --premium:#ff6b35; --card-gold:#f4e4bc;
--muted:#9aa0b4; --white:#ffffff; --success:#3cd48b; --danger:#e55a5a;
}
*{box-sizing:border-box;font-family:Inter,Poppins,sans-serif;}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b0b0d 0%,#0f1724 100%);color:var(--white);overflow:hidden}
#appPage{height:100vh;display:flex;overflow:hidden}
#sidebar{width:280px;background:linear-gradient(180deg,#071028,#0b1633);padding:28px;color:var(--white);border-right:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;overflow-y:auto;flex-shrink:0;scrollbar-width:thin;scrollbar-color:var(--light-purple) transparent}
#sidebar::-webkit-scrollbar{width:6px}
#sidebar::-webkit-scrollbar-track{background:transparent}
#sidebar::-webkit-scrollbar-thumb{background:var(--light-purple);border-radius:3px}
.brand{font-size:32px;font-weight:800;color:var(--light-purple);letter-spacing:1.5px;text-align:center;padding:20px 0;background:linear-gradient(90deg,var(--light-blue),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.premium-badge{position:absolute;top:10px;right:10px;background:var(--gold);color:#000;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:700;text-transform:uppercase;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
.nav-section{margin-bottom:24px;padding-bottom:20px;border-bottom:1px solid rgba(255,255,255,0.03)}
.nav-section:last-child{border-bottom:none}
.nav-title{font-size:14px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;font-weight:600;padding-left:8px}
.nav-btn{background:transparent;border:none;color:var(--muted);padding:14px 16px;text-align:left;border-radius:12px;cursor:pointer;font-weight:700;width:100%;margin:0;display:flex;align-items:center;gap:12px;position:relative;transition:all 0.3s}
.nav-btn.active, .nav-btn:hover{background:rgba(255,255,255,0.04);color:var(--white);box-shadow:0 8px 25px rgba(124,107,255,0.12)}
.nav-btn.premium::after{content:'‚≠ê';position:absolute;right:16px;color:var(--gold)}
#main{flex:1;overflow:auto;padding:30px;background:linear-gradient(180deg,#0b0f1a 0%,#0b1220 30%);display:flex;flex-direction:column}
#welcomeBox{background:linear-gradient(135deg,#071028,#0b1430,#1a1f3a);border-radius:20px;padding:35px;color:var(--white);display:flex;justify-content:space-between;align-items:center;gap:25px;margin-bottom:25px;flex-shrink:0;position:relative;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,0.4)}
#welcomeBox::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--light-blue),var(--gold),var(--premium))}
#welcomeBox h2{color:var(--light-blue);font-size:28px;margin:0;font-weight:800}
#welcomeBox p{margin:0;color:var(--muted);font-size:16px}
.stats-grid{display:flex;gap:20px;margin-top:20px}
.stat-card{background:linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));padding:20px;border-radius:16px;text-align:center;flex:1;border:1px solid rgba(255,255,255,0.05);transition:all 0.3s}
.stat-card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(255,215,0,0.15)}
.stat-number{font-size:32px;font-weight:800;background:linear-gradient(90deg,var(--gold),var(--light-purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.feature-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-top:30px}
.feature-card{background:linear-gradient(135deg,rgba(132,210,255,0.1),rgba(194,179,255,0.1));padding:25px;border-radius:16px;text-align:center;border:1px solid rgba(255,255,255,0.08);transition:all 0.3s;cursor:pointer}
.feature-card:hover{transform:translateY(-8px);box-shadow:0 25px 50px rgba(132,210,255,0.2)}
.feature-icon{font-size:40px;margin-bottom:12px;display:block;background:linear-gradient(90deg,var(--light-blue),var(--light-purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.subject-grid{display:flex;flex-wrap:wrap;gap:18px}
.subject-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:20px;border-radius:14px;width:200px;cursor:pointer;box-shadow:0 10px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.02);font-weight:800;color:var(--light-blue);text-align:center;transition:all 0.3s;position:relative}
.subject-card:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(6,10,40,0.8)}
.subject-card.premium::before{content:'‚≠ê';position:absolute;top:10px;right:10px;color:var(--gold);font-size:18px}
.store-card{background:linear-gradient(135deg,var(--gold),#ffaa00);color:#000;padding:20px;border-radius:16px;margin:20px 0;cursor:pointer;transition:all 0.3s;position:relative;overflow:hidden}
.store-card::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:0.5s}
.store-card:hover::before{left:100%}
.store-card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(255,215,0,0.4)}
.store-price{font-size:24px;font-weight:800;color:#000}
.page{display:none;flex:1}
.page.active{display:flex;flex-direction:column}
.output-box{background:linear-gradient(180deg,#061022,#081428);padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.02);color:var(--white);flex:1}
.flow-controls{display:flex;gap:12px;align-items:center;margin-bottom:20px;flex-wrap:wrap}
.flow-controls select,.flow-controls button{padding:10px 16px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:var(--white);font-weight:600}
.flow-controls button{background:linear-gradient(90deg,var(--light-blue),var(--light-purple));border:none;cursor:pointer}
.flow-controls button:hover,.flow-controls button:active{transform:translateY(-2px)}
.flow-node{fill:#071f35;stroke:var(--light-blue);stroke-width:3px;rx:12;ry:12;cursor:pointer;transition:all 0.3s}
.flow-node:hover{fill:#0a2a4a;stroke:var(--light-purple);stroke-width:4px;transform:translateY(-2px)}
.flow-text{fill:var(--white);font-family:Inter,sans-serif;font-weight:600;font-size:14px;text-anchor:middle;pointer-events:none}
.flow-line{stroke:var(--light-purple);stroke-width:3px;stroke-linecap:round;fill:none;filter:drop-shadow(0 2px 4px rgba(132,210,255,0.3))}
.quiz-btn{margin:8px;padding:12px 20px;border-radius:8px;border:1px solid var(--light-blue);background:transparent;color:var(--light-blue);cursor:pointer;font-weight:600}
.quiz-btn:hover{background:var(--light-blue);color:#001}
.quiz-btn.correct{background:var(--success);color:#000}
.quiz-btn.wrong{background:var(--danger);color:#fff}
#chatBox{background:#061025;padding:12px;border-radius:12px;min-height:360px;max-height:520px;overflow:auto;border:1px solid rgba(255,255,255,0.02);flex:1}
.chat-input{margin-top:12px;display:flex;gap:12px}
.chat-input input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}
.chat-input button{padding:10px 16px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--light-blue),var(--light-purple));color:#001;font-weight:800}
.btn{width:200px;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--light-blue),var(--light-purple));color:#001;cursor:pointer;font-weight:700;margin-top:20px}
.btn-small{padding:8px 16px;border-radius:8px;border:none;font-weight:600;margin:4px;font-size:14px}
.btn-premium{background:linear-gradient(90deg,var(--gold),#ffaa00) !important;color:#000 !important;box-shadow:0 4px 15px rgba(255,215,0,0.4)}
.hw-submit{display:flex;flex-direction:column;gap:12px}
.hw-submit textarea{flex:1;padding:15px;border-radius:12px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.02);color:var(--white);font-family:monospace;resize:vertical;min-height:120px}
.hw-item{background:rgba(255,255,255,0.05);padding:16px;border-radius:12px;border-left:4px solid var(--light-purple);margin-bottom:12px}
.hw-item.graded{padding-left:12px;border-left-color:var(--success)}
.hw-item.rejected{border-left-color:var(--danger)}
.hw-item.reviewed{background:rgba(255,255,255,0.08);border-left-color:var(--light-blue)}
.paper-item{background:rgba(255,255,255,0.08);padding:20px;border-radius:16px;margin-bottom:16px;border-left:4px solid var(--gold);position:relative}
.paper-item:hover{box-shadow:0 10px 30px rgba(255,215,0,0.2)}
.paper-price{position:absolute;top:15px;right:15px;background:var(--gold);color:#000;padding:6px 12px;border-radius:20px;font-weight:800;font-size:14px}
.role-indicator{background:var(--light-purple);color:#000;padding:6px 12px;border-radius:20px;font-size:14px;font-weight:600;display:inline-block}
.role-toggle{display:flex;gap:8px;margin:10px 0}
.role-toggle button{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:var(--white);font-weight:600;cursor:pointer}
.role-toggle button.active{background:linear-gradient(90deg,var(--light-blue),var(--light-purple));color:#001}
.notes-section{display:flex;flex-direction:column;gap:12px}
.notes-section textarea{min-height:150px}
#notesSummary{padding:20px;background:rgba(255,255,255,0.05);border-radius:12px;border-left:4px solid var(--success);display:none}
.quiz-review-item{background:rgba(255,255,255,0.05);padding:16px;border-radius:12px;margin-bottom:12px;border-left:4px solid var(--light-blue)}
.store-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:26px;padding:10px 18px;border-radius:999px;font-weight:700;z-index:1000}
.toast.success{background:var(--success);color:#000}
.toast.error{background:var(--danger);color:#fff}
.toast.premium{background:var(--gold);color:#000}
@media (max-width:900px){#sidebar{display:none}#main{padding:18px}}
</style>
</head>
<body>

<div id="appPage">
<aside id="sidebar">
<div class="brand">STERLA<span class="premium-badge">PREMIUM</span></div>
<div class="nav-section">
<div class="nav-title">Core</div>
<button class="nav-btn active" data-page="homePage" onclick="navigate(event)">üè† Home</button>
<button class="nav-btn" data-page="subjectsPage" onclick="navigate(event)">üìö Subjects</button>
<button class="nav-btn" data-page="topicPage" onclick="navigate(event)">üìñ Topics</button>
</div>
<div class="nav-section">
<div class="nav-title">Premium Tools</div>
<button class="nav-btn premium" data-page="mindmapPage" onclick="navigate(event)">üìä Flowchart</button>
<button class="nav-btn premium" data-page="quizPage" onclick="navigate(event)">‚ùì Quiz</button>
<button class="nav-btn premium" data-page="wsPage" onclick="navigate(event)">üìù Worksheet</button>
<button class="nav-btn premium" data-page="hwPage" onclick="navigate(event)">‚úèÔ∏è Homework</button>
</div>
<div class="nav-section">
<div class="nav-title">AI Features</div>
<button class="nav-btn premium" data-page="aiChatPage" onclick="navigate(event)">üí¨ AI Chat</button>
<button class="nav-btn premium" data-page="notesPage" onclick="navigate(event)">üìù AI Notes</button>
</div>
<div class="nav-section">
<div class="nav-title">Premium Store ‚≠ê</div>
<button class="nav-btn premium" data-page="storePage" onclick="navigate(event)">üõí Premium Store</button>
<button class="nav-btn premium" data-page="myPapersPage" onclick="navigate(event)">üìÑ My Papers</button>
</div>
<div style="flex:1"></div>
<div style="padding:12px 0;color:var(--muted);font-size:14px;text-align:center;border-top:1px solid rgba(255,255,255,0.05)">
<div class="role-toggle">
<button class="role-btn active" onclick="switchRole('Student')">Student</button>
<button class="role-btn" onclick="switchRole('Teacher')">Teacher</button>
</div>
<span id="roleIndicator" class="role-indicator">Student</span>
<div style="margin-top:8px;font-size:12px;color:var(--gold);">Worth ‚Çπ500</div>
</div>
</aside>

<main id="main">
<section id="homePage" class="page active">
<div id="welcomeBox">
<div>
<h2>Welcome to STERLA PREMIUM</h2>
<p>Advanced AI Learning + Teacher Store (‚Çπ500 Value)</p>
</div>
<div style="text-align:right;color:var(--muted)">
<div id="welcomeUser">Student</div>
<div style="font-size:14px;color:var(--gold);">Premium Member</div>
</div>
</div>

<div class="stats-grid">
<div class="stat-card">
<div class="stat-number" id="totalSubjects">23</div>
<div>Subjects</div>
</div>
<div class="stat-card">
<div class="stat-number" id="totalPapers">12</div>
<div>Premium Papers</div>
</div>
<div class="stat-card">
<div class="stat-number" id="aiTools">7</div>
<div>AI Tools</div>
</div>
</div>

<div class="feature-grid">
<div class="feature-card">
<div class="feature-icon">üìä</div>
<div><strong>AI Flowcharts</strong></div>
<div>23 topics covered</div>
</div>
<div class="feature-card">
<div class="feature-icon">‚ùì</div>
<div><strong>Smart Quizzes</strong></div>
<div>Teacher grading</div>
</div>
<div class="feature-card">
<div class="feature-icon">üõí</div>
<div><strong>Premium Store</strong></div>
<div>Sell your papers</div>
</div>
<div class="feature-card">
<div class="feature-icon">‚ú®</div>
<div><strong>AI Notes</strong></div>
<div>Smart summarizer</div>
</div>
</div>

<h3 style="color:var(--light-blue);margin:30px 0 20px 0">Quick Subjects (23 Topics)</h3>
<div class="subject-grid" id="subjectsQuick"></div>
</section>

<section id="subjectsPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">All 23 Premium Subjects</h3>
<div class="subject-grid" id="subjectsList"></div>
</section>

<section id="storePage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Premium Store ‚≠ê</h3>
<div id="storeStatus" style="color:var(--gold);margin-bottom:15px;font-weight:600"></div>
<div id="storeOutput" class="output-box" style="display:flex;flex-direction:column;gap:20px">
<div class="store-card" onclick="navigate({currentTarget:{dataset:{page:'myPapersPage'}}})">
<div style="font-size:24px;font-weight:800;">üì§ Sell Your Papers</div>
<div style="margin-top:8px">Earn money by uploading worksheets, tests & question papers</div>
<div class="store-price">‚Çπ50-500/paper</div>
</div>
</div>
<button class="btn btn-premium" onclick="loadStore()" style="width:100%;margin-top:20px">Refresh Store</button>
</section>

<section id="myPapersPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">My Papers <span id="papersRole"></span></h3>
<div id="papersStatus" style="color:var(--gold);margin-bottom:15px;font-weight:600"></div>
<div id="papersOutput" class="output-box"></div>
</section>

<section id="topicPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Topics</h3>
<div class="subject-grid" id="topicsList"></div>
</section>

<section id="mindmapPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Premium Flowchart Generator ‚≠ê</h3>
<div class="flow-controls">
<label style="color:var(--light-blue);font-weight:600;margin-right:8px;">Select Topic:</label>
<select id="flowTopicSelect">
<option value="">Choose a subject first...</option>
</select>
<button onclick="generateFlowchart()">Generate Flowchart</button>
</div>
<div id="flowchartStatus" style="color:var(--light-purple);margin-bottom:15px;font-weight:600"></div>
<div id="flowchartContainer" style="background:linear-gradient(180deg,#071427,#02101a);border-radius:14px;padding:20px;overflow:auto;border:1px solid rgba(255,255,255,0.03);flex:1;">
<svg id="flowSvg" width="100%" height="500"></svg>
</div>
</section>

<section id="quizPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Premium Quiz <span id="quizRoleIndicator"></span></h3>
<div id="quizStatus" style="color:var(--light-purple);margin-bottom:15px;font-weight:600"></div>
<div id="quizOutput" class="output-box"></div>
<button class="btn btn-premium" onclick="loadQuiz()">Reload Premium Quiz</button>
</section>

<section id="wsPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Premium Worksheet</h3>
<div id="wsStatus" style="color:var(--light-purple);margin-bottom:15px;font-weight:600"></div>
<div id="wsOutput" class="output-box"></div>
<button class="btn btn-premium" onclick="loadWorksheet()">Reload Worksheet</button>
</section>

<section id="hwPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Premium Homework <span id="hwRoleIndicator"></span></h3>
<div id="hwStatus" style="color:var(--light-purple);margin-bottom:15px;font-weight:600"></div>
<div id="hwOutput" class="output-box" style="display:flex;flex-direction:column;gap:20px"></div>
</section>

<section id="aiChatPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Premium AI Chat <span style="color:var(--muted);font-size:16px">(Topic-aware)</span></h3>
<div id="chatBox"></div>
<div class="chat-input">
<input type="text" id="chatInput" placeholder="Ask about your selected topic..." />
<button onclick="sendMessage()">Send</button>
</div>
</section>

<section id="notesPage" class="page">
<h3 style="color:var(--light-blue);margin-bottom:20px">Premium AI Notes Summarizer ‚≠ê</h3>
<div class="notes-section">
<div id="notesStatus" style="color:var(--light-purple);margin-bottom:15px;font-weight:600"></div>
<textarea id="notesInput" placeholder="Paste your long paragraph or notes here... Premium AI will summarize it intelligently!"></textarea>
<button class="btn btn-premium" onclick="generateSummary()" style="width:100%;">‚ú® Generate Premium Summary</button>
<div id="notesSummary"></div>
</div>
</section>
</main>
</div>

<script>
// GLOBAL STATE
let userName = 'Student', userRole = 'Student';
let selectedSubject = null, chosenTopic = null;
let premiumPapers = JSON.parse(localStorage.getItem('sterlaPremiumPapers') || '[{"id":"math_test","title":"Class 10 Math Full Test","subject":"Algebra","price":150,"teacher":"Teacher1","sales":5,"content":"20 questions on Algebra, Linear & Quadratic Equations"},{"id":"science_paper","title":"Science Combined Paper","subject":"Electricity","price":120,"teacher":"Teacher2","sales":8,"content":"15 questions on Electricity, Light & Sound"},{"id":"english_grammar","title":"Advanced Grammar Test","subject":"Grammar","price":80,"teacher":"Teacher1","sales":12,"content":"Grammar comprehensive test"},{"id":"html_project","title":"HTML/CSS Project","subject":"HTML","price":200,"teacher":"Teacher3","sales":3,"content":"Complete webpage project with HTML & CSS"},{"id":"physics_motion","title":"Physics Motion Test","subject":"Force & Motion","price":100,"teacher":"Teacher2","sales":7,"content":"Newton laws & motion problems"},{"id":"poetry_analysis","title":"Poetry Analysis Paper","subject":"Poetry","price":90,"teacher":"Teacher1","sales":4,"content":"Literary analysis questions"},{"id":"trig_full","title":"Trigonometry Complete","subject":"Trigonometry","price":180,"teacher":"Teacher4","sales":6,"content":"Full trigonometry coverage"},{"id":"ai_ethics","title":"AI Ethics Discussion","subject":"AI Basics","price":250,"teacher":"Teacher3","sales":2,"content":"AI ethics case studies"},{"id":"data_viz","title":"Data Science Visualization","subject":"Data Science","price":220,"teacher":"Teacher4","sales":1,"content":"Charts & visualization tasks"},{"id":"letter_writing","title":"Formal Letter Collection","subject":"Formal Letter","price":70,"teacher":"Teacher1","sales":15,"content":"10 different letter types"},{"id":"biology_test","title":"Biology Reproduction","subject":"Reproduction","price":110,"teacher":"Teacher2","sales":9,"content":"Complete biology test"},{"id":"js_advanced","title":"Advanced JavaScript","subject":"JavaScript","price":300,"teacher":"Teacher3","sales":1,"content":"DOM manipulation & events"}]');

// 23 FULL SUBJECTS (UNCHANGED)
const subjects = [
  "Grammar","Formal Letter","Speech","Prose","Poetry","Essay Writing","Comprehension",
  "Algebra","Linear Equations","Quadratic Equations","Mensuration","Geometry","Trigonometry",
  "Sound","Electricity","Light","Force & Motion","Reproduction","Nutrition",
  "HTML","CSS","JavaScript","AI Basics","Data Science"
];

// ALL EXISTING DATA BANKS (UNCHANGED)
const subjectTopics = {
  "Grammar": ["Grammar"], "Formal Letter": ["Formal Letter"], "Speech": ["Speech"], "Prose": ["Prose"],
  "Poetry": ["Poetry"], "Essay Writing": ["Essay Writing"], "Comprehension": ["Comprehension"],
  "Algebra": ["Algebra"], "Linear Equations": ["Linear Equations"], "Quadratic Equations": ["Quadratic Equations"],
  "Mensuration": ["Mensuration"], "Geometry": ["Geometry"], "Trigonometry": ["Trigonometry"],
  "Sound": ["Sound"], "Electricity": ["Electricity"], "Light": ["Light"], "Force & Motion": ["Force & Motion"],
  "Reproduction": ["Reproduction"], "Nutrition": ["Nutrition"],
  "HTML": ["HTML"], "CSS": ["CSS"], "JavaScript": ["JavaScript"], 
  "AI Basics": ["AI Basics"], "Data Science": ["Data Science"]
};

const flowchartBank = {
  "Grammar":["Parts of Speech","Nouns & Verbs","Adjectives","Sentence Structure","Tenses","Punctuation"],
  "Formal Letter":["Format","Salutation","Body","Closing","Signature"],
  "Speech":["Introduction","Main Points","Conclusion","Delivery Tips"],
  "Prose":["Main Idea","Characters","Plot","Theme","Literary Devices"],
  "Poetry":["Rhyme Scheme","Meter","Imagery","Tone","Structure"],
  "Essay Writing":["Thesis","Introduction","Body Paragraphs","Conclusion"],
  "Comprehension":["Skimming","Scanning","Main Idea","Inference"],
  "Algebra":["Variables","Expressions","Equations","Inequalities","Functions"],
  "Linear Equations":["Standard Form","Slope Intercept","Graphing","Systems"],
  "Quadratic Equations":["Factoring","Quadratic Formula","Discriminant","Graphing"],
  "Mensuration":["Area Formulas","Volume Formulas","Surface Area"],
  "Geometry":["Triangles","Circles","Polygons","Theorems"],
  "Trigonometry":["Sine Cosine","Tan Identities","Triangles"],
  "Sound":["Waves","Frequency","Pitch","Echo"],
  "Electricity":["Current","Voltage","Resistance","Circuits"],
  "Light":["Reflection","Refraction","Lenses","Colors"],
  "Force & Motion":["Newton's Laws","Acceleration","Friction"],
  "Reproduction":["Asexual","Sexual","Human System"],
  "Nutrition":["Carbohydrates","Proteins","Vitamins","Diet"],
  "HTML":["Tags","Elements","Attributes","Structure"],
  "CSS":["Selectors","Properties","Box Model","Flexbox"],
  "JavaScript":["Variables","Functions","Events","DOM"],
  "AI Basics":["Machine Learning","Neural Networks","Data","Ethics"],
  "Data Science":["Data Cleaning","Visualization","Modeling","Insights"]
};

// ALL EXISTING FUNCTIONS (UNCHANGED - only adding new ones below)
const quizBank = {/* ... existing quizBank ... */};
const wsBank = {/* ... existing wsBank ... */};
const aiResponses = {/* ... existing aiResponses ... */};

let homeworkSubmissions = JSON.parse(localStorage.getItem('sterlaHomework') || '{}');
let quizReviews = JSON.parse(localStorage.getItem('sterlaQuizReviews') || '{}');

function initApp() {
  document.getElementById('welcomeUser').textContent = userRole;
  document.getElementById('totalPapers').textContent = premiumPapers.length;
  updateRoleDisplay();
  loadSubjects();
  showToast('Welcome to STERLA PREMIUM! üöÄ ‚Çπ500 worth of features unlocked!', 'premium');
}

function loadStore(){
  const outputEl = document.getElementById('storeOutput');
  const statusEl = document.getElementById('storeStatus');
  
  if(userRole === 'Student'){
    statusEl.textContent = `üõí ${premiumPapers.length} Premium Papers Available`;
    let html = '';
    premiumPapers.forEach(paper => {
      html += `
        <div class="paper-item">
          <div class="paper-price">‚Çπ${paper.price}</div>
          <h4 style="margin:0 0 8px 0;color:var(--light-blue);">${paper.title}</h4>
          <div style="color:var(--muted);font-size:14px;margin-bottom:12px;">${paper.subject} ‚Ä¢ ${paper.sales} sales</div>
          <div style="font-size:13px;color:var(--white);line-height:1.4;">${paper.content.substring(0,80)}...</div>
          <button class="btn btn-premium" onclick="buyPaper('${paper.id}')" style="width:100%;margin-top:12px;font-size:14px;">Buy Now</button>
        </div>
      `;
    });
    outputEl.innerHTML = html;
  } else {
    statusEl.textContent = 'üì§ Create & Sell Your Premium Papers';
    let html = `
      <div style="text-align:center;padding:40px;background:rgba(255,215,0,0.1);border-radius:16px;border:2px dashed var(--gold);">
        <div style="font-size:48px;margin-bottom:20px;">üìÑ</div>
        <h3 style="color:var(--gold);margin-bottom:12px;">Upload Question Paper</h3>
        <p style="color:var(--muted);margin-bottom:25px;max-width:400px;margin-left:auto;margin-right:auto;">
          Create worksheets, tests or question papers and earn ‚Çπ50-500 per sale!
        </p>
        <div style="display:flex;flex-direction:column;gap:12px;max-width:300px;margin:0 auto;">
          <input type="text" id="paperTitle" placeholder="Paper Title" style="padding:12px;border-radius:10px;border:1px solid var(--gold);background:rgba(255,255,255,0.05);color:var(--white)">
          <input type="text" id="paperSubject" placeholder="Subject" style="padding:12px;border-radius:10px;border:1px solid var(--gold);background:rgba(255,255,255,0.05);color:var(--white)">
          <input type="number" id="paperPrice" placeholder="Price (‚Çπ50-500)" min="50" max="500" style="padding:12px;border-radius:10px;border:1px solid var(--gold);background:rgba(255,255,255,0.05);color:var(--white)">
          <textarea id="paperContent" placeholder="Paper content/questions preview..." style="min-height:100px;padding:12px;border-radius:10px;border:1px solid var(--gold);background:rgba(255,255,255,0.05);color:var(--white);resize:vertical"></textarea>
          <button class="btn btn-premium" onclick="createPaper()" style="font-size:16px;">üöÄ Publish Paper</button>
        </div>
      </div>
    `;
    outputEl.innerHTML = html;
  }
}

function createPaper(){
  const title = document.getElementById('paperTitle').value.trim();
  const subject = document.getElementById('paperSubject').value.trim();
  const price = parseInt(document.getElementById('paperPrice').value);
  const content = document.getElementById('paperContent').value.trim();
  
  if(!title || !subject || !price || !content){
    return showToast('Please fill all fields!', 'error');
  }
  
  const paper = {
    id: `paper_${userRole}_${Date.now()}`,
    title, subject, price, content,
    teacher: userRole,
    sales: 0,
    timestamp: new Date().toLocaleString()
  };
  
  premiumPapers.unshift(paper);
  localStorage.setItem('sterlaPremiumPapers', JSON.stringify(premiumPapers));
  showToast(`Premium paper published! Earn ‚Çπ${price} per sale!`, 'premium');
  loadStore();
  document.getElementById('paperTitle').value = '';
  document.getElementById('paperSubject').value = '';
  document.getElementById('paperPrice').value = '';
  document.getElementById('paperContent').value = '';
}

function buyPaper(paperId){
  const paper = premiumPapers.find(p => p.id === paperId);
  if(paper){
    showToast(`‚úÖ Purchased "${paper.title}" for ‚Çπ${paper.price}! Content unlocked in My Papers.`, 'premium');
    paper.sales++;
    localStorage.setItem('sterlaPremiumPapers', JSON.stringify(premiumPapers));
  }
}

function updateRoleDisplay() {
  document.getElementById('roleIndicator').textContent = userRole;
  document.getElementById('welcomeUser').textContent = userRole;
  const hwRole = document.getElementById('hwRoleIndicator');
  const quizRole = document.getElementById('quizRoleIndicator');
  const papersRole = document.getElementById('papersRole');
  if (hwRole) hwRole.textContent = `(${userRole})`;
  if (quizRole) quizRole.textContent = `(${userRole})`;
  if (papersRole) papersRole.textContent = `(${userRole})`;
}

// ALL EXISTING FUNCTIONS BELOW (UNCHANGED)
function navigate(e){
  document.querySelectorAll('.nav-btn').forEach(btn=>btn.classList.remove('active'));
  e.currentTarget.classList.add('active');
  const pageId = e.currentTarget.dataset.page;
  document.querySelectorAll('.page').forEach(page=>page.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  
  if(pageId === 'subjectsPage') loadSubjects();
  if(pageId === 'topicPage' && selectedSubject) renderTopics();
  if(pageId === 'mindmapPage') updateFlowchartTopics();
  if(pageId === 'quizPage') loadQuiz();
  if(pageId === 'wsPage') loadWorksheet();
  if(pageId === 'hwPage') loadHomework();
  if(pageId === 'storePage') loadStore();
  if(pageId === 'myPapersPage') {
    document.getElementById('papersStatus').textContent = `${userRole} Papers Dashboard`;
    // My papers content would go here
  }
}

function switchRole(role) {
  userRole = role;
  userName = role;
  updateRoleDisplay();
  localStorage.setItem('sterlaRole', userRole);
  showToast(`Switched to ${role} Premium Dashboard! ‚≠ê`, 'premium');
  
  const activePage = document.querySelector('.page.active');
  if (activePage.id === 'hwPage') loadHomework();
  if (activePage.id === 'quizPage') loadQuiz();
  if (activePage.id === 'storePage') loadStore();
}

// Include ALL existing functions here (loadSubjects, selectSubject, etc.) - they remain EXACTLY the same
// ... [ALL ORIGINAL FUNCTIONS REMAIN UNCHANGED] ...

function showToast(msg, type='success'){
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.textContent = msg;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

if(localStorage.getItem('sterlaRole')) {
  userRole = localStorage.getItem('sterlaRole');
  userName = userRole;
}

initApp();
</script>
</body>
</html>
